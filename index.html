<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Corny Stories</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fefefe;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #6c63ff;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      letter-spacing: 2px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    nav {
      display: flex;
      background: #f0f0f5;
      border-bottom: 1px solid #ddd;
      justify-content: center;
    }
    nav button {
      background: none;
      border: none;
      padding: 1rem 2rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    nav button:hover, nav button.active {
      background-color: #6c63ff;
      color: white;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h1.story-title {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: #6c63ff;
    }
    .story-content {
      white-space: pre-wrap;
      line-height: 1.5;
      font-size: 1.1rem;
      background: #fafafa;
      border-left: 5px solid #6c63ff;
      padding: 1rem 1.5rem;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
      margin-bottom: 1.5rem;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    label {
      font-weight: 600;
      font-size: 1.1rem;
    }
    input[type="text"], textarea {
      padding: 0.75rem;
      font-size: 1rem;
      border: 1.5px solid #ccc;
      border-radius: 4px;
      resize: vertical;
      min-height: 120px;
    }
    textarea {
      min-height: 150px;
    }
    button.submit-btn {
      max-width: 150px;
      padding: 0.7rem 1rem;
      background-color: #6c63ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 700;
      transition: background-color 0.3s ease;
    }
    button.submit-btn:hover {
      background-color: #5548c8;
    }
    .stories-list {
      margin-top: 2rem;
    }
    .story-item {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 1rem;
      margin-bottom: 1rem;
      background: #fff;
      box-shadow: 0 1px 4px rgb(0 0 0 / 0.05);
      position: relative;
    }
    .story-item h3 {
      margin: 0 0 0.5rem 0;
      color: #6c63ff;
    }
    .author {
      font-style: italic;
      color: #666;
      margin-bottom: 0.5rem;
    }
    .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff4d4d;
      color: white;
      border: none;
      padding: 0.3rem 0.6rem;
      font-size: 0.9rem;
      border-radius: 3px;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s ease;
    }
    .delete-btn:hover {
      opacity: 1;
    }
    footer {
      text-align: center;
      padding: 1rem;
      margin-top: 3rem;
      border-top: 1px solid #ddd;
      color: #777;
      font-size: 0.9rem;
    }
    .audio-btn {
      background: #6c63ff;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      font-weight: 600;
      margin-top: 0.5rem;
      transition: background-color 0.3s ease;
    }
    .audio-btn:hover {
      background-color: #5548c8;
    }
  </style>
</head>
<body>
  <header>Corny Stories</header>
  <nav>
    <button id="btnStory" class="active">Three's a Fever</button>
    <button id="btnAddStory">Add More Stories</button>
  </nav>

  <main>
    <!-- Story content container -->
    <section id="storySection">
      <h1 class="story-title">Three's a Fever</h1>
      <div class="story-content" id="storyContent">
        <!-- The original story with authors -->
        <p><em>Author(s): Addisyn Holley, Jordan Schaller, Donovan Schaller</em></p>

The music pulsed low through the dim living room, amber lights painting soft shadows on the walls. Sophia sat curled into the corner of the couch, legs crossed, wine glass in hand. Her gaze flicked between the two across the room ‚Äî Gauge, effortlessly cool, leaning against the doorframe, and Justin, sprawled across the armchair like he owned the place.

None of them said much, but the energy was thick. Tangible.

Gauge caught her glance and smirked. ‚ÄúYou‚Äôre awfully quiet, Sophia.‚Äù

She tilted her head slightly, lips curling. ‚ÄúJust enjoying the view.‚Äù

Justin let out a low laugh. ‚ÄúYou mean me or him?‚Äù

‚ÄúBoth,‚Äù she said, without hesitation.

That earned a glance between the two men ‚Äî a silent exchange that said more than words ever could. Gauge finally moved from the wall, walking over to the couch with slow, confident steps. He sat beside her, close enough that his leg brushed against hers, just barely.

Sophia didn‚Äôt move away.

Justin stayed still at first, watching them like a storm building. Then he rose, slow and deliberate, circling around the back of the couch. His fingers brushed the side of her neck ‚Äî a featherlight touch that made her eyes flutter shut for just a second.

The tension crackled.

‚ÄúYou know,‚Äù Gauge murmured near her ear, ‚Äúwe‚Äôve both noticed the way you look at us.‚Äù

Sophia turned slightly, heartbeat climbing. ‚ÄúAnd what if I‚Äôve noticed the way you look at me?‚Äù

Justin leaned down, voice smooth. ‚ÄúThen maybe it‚Äôs time we stop dancing around it.‚Äù

Gauge‚Äôs hand slipped to the small of her back. Justin‚Äôs breath was warm against her neck. The air between them tightened, thick with heat, and for a moment ‚Äî just a breathless moment ‚Äî no one moved.

Three hearts, one spark.

And the night had only just begun.

<!-- You can continue the original story as needed -->
      </div>

      <!-- Container for user-added stories -->
      <h2>User Submitted Stories</h2>
      <div id="userStories"></div>
    </section>

    <!-- Add story section -->
    <section id="addStorySection" style="display:none;">
      <h1>Add a New Story</h1>
      <form id="storyForm">
        <label for="authorFirstNameInput">First Name:</label>
        <input type="text" id="authorFirstNameInput" name="authorFirstName" placeholder="Enter your first name" required />

        <label for="authorLastNameInput">Last Name:</label>
        <input type="text" id="authorLastNameInput" name="authorLastName" placeholder="Enter your last name" required />

        <label for="titleInput">Story Title:</label>
        <input type="text" id="titleInput" name="title" placeholder="Enter story title" required />

        <label for="contentInput">Story Content:</label>
        <textarea id="contentInput" name="content" placeholder="Enter story content" required></textarea>

        <button type="submit" class="submit-btn">Add Story</button>
      </form>

      <div class="stories-list" id="storiesList">
        <h2>Added Stories:</h2>
        <div id="addedStoriesContainer">
          <!-- dynamically added stories will appear here -->
        </div>
      </div>
    </section>
  </main>

  <footer>
    &copy; 2025 Corny Stories. All rights reserved.
  </footer>

  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA11pEoYkNCIe6sQOMx15gt4YK7oJnGSis",
      authDomain: "corny-stories.firebaseapp.com",
      projectId: "corny-stories",
      storageBucket: "corny-stories.firebasestorage.app",
      messagingSenderId: "1048985672409",
      appId: "1:1048985672409:web:cc9460c35e68ab6f6ebcc8",
      measurementId: "G-FL9WHM0BVG"
    };

    // Initialize Firebase and Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // UI Elements
    const btnStory = document.getElementById('btnStory');
    const btnAddStory = document.getElementById('btnAddStory');
    const storySection = document.getElementById('storySection');
    const addStorySection = document.getElementById('addStorySection');
    const storyForm = document.getElementById('storyForm');
    const addedStoriesContainer = document.getElementById('addedStoriesContainer');
    const userStoriesDiv = document.getElementById('userStories');

    // Current user identifier stored in localStorage (first+last lowercase)
    function getCurrentUserId() {
      const first = localStorage.getItem('authorFirstName') || '';
      const last = localStorage.getItem('authorLastName') || '';
      return (first.trim() + last.trim()).toLowerCase();
    }

    // Toggle tabs
    btnStory.addEventListener('click', () => {
      btnStory.classList.add('active');
      btnAddStory.classList.remove('active');
      storySection.style.display = 'block';
      addStorySection.style.display = 'none';
      renderAllStories();
    });

    btnAddStory.addEventListener('click', () => {
      btnAddStory.classList.add('active');
      btnStory.classList.remove('active');
      addStorySection.style.display = 'block';
      storySection.style.display = 'none';
      renderAddedStories();
    });

    // Render the original static story only once (already in HTML)
    // We'll just add user stories dynamically to storySection's #userStories div

    // Render added stories in Add Story tab
    async function renderAddedStories() {
      // Fetch all stories from Firestore ordered by newest first
      const storiesCol = collection(db, 'stories');
      const q = query(storiesCol, orderBy('createdAt', 'desc'));

      // Clear container
      addedStoriesContainer.innerHTML = '<p>Loading...</p>';

      onSnapshot(q, (snapshot) => {
        if (snapshot.empty) {
          addedStoriesContainer.innerHTML = '<p>No stories added yet. Use the form above to add one!</p>';
          return;
        }
        addedStoriesContainer.innerHTML = '';
        snapshot.forEach(docSnap => {
          const story = docSnap.data();
          const storyId = docSnap.id;
          const div = document.createElement('div');
          div.classList.add('story-item');
          div.innerHTML = `
            <h3>${story.title}</h3>
            <p class="author">By: ${story.authorFirstName} ${story.authorLastName}</p>
            <p>${story.content.replace(/\n/g, '<br>')}</p>
          `;

          // Only show delete button if current user is author
          if (getCurrentUserId() === (story.authorFirstName + story.authorLastName).toLowerCase()) {
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.textContent = 'Delete';
            deleteBtn.addEventListener('click', async () => {
              if(confirm('Are you sure you want to delete this story?')) {
                await deleteDoc(doc(db, 'stories', storyId));
                alert('Story deleted!');
              }
            });
            div.appendChild(deleteBtn);
          }
          addedStoriesContainer.appendChild(div);
        });
      });
    }

    // Render all stories including original + user stories on main tab
    function renderAllStories() {
      userStoriesDiv.innerHTML = '<p>Loading user stories...</p>';
      const storiesCol = collection(db, 'stories');
      const q = query(storiesCol, orderBy('createdAt', 'desc'));

      onSnapshot(q, (snapshot) => {
        if (snapshot.empty) {
          userStoriesDiv.innerHTML = '<p>No user stories yet.</p>';
          return;
        }
        userStoriesDiv.innerHTML = '';
        snapshot.forEach(docSnap => {
          const story = docSnap.data();
          const div = document.createElement('div');
          div.classList.add('story-content');
          div.innerHTML = `
            <h3>${story.title}</h3>
            <p class="author">By: ${story.authorFirstName} ${story.authorLastName}</p>
            <p>${story.content.replace(/\n/g, '<br>')}</p>
          `;

          // Add audio read-aloud button for this story
          const audioBtn = document.createElement('button');
          audioBtn.className = 'audio-btn';
          audioBtn.textContent = 'üîä Listen';
          audioBtn.addEventListener('click', () => {
            // Use SpeechSynthesis API to read the story content aloud
            if(window.speechSynthesis.speaking){
              window.speechSynthesis.cancel();
            }
            const utterance = new SpeechSynthesisUtterance(story.title + '. ' + story.content);
            utterance.lang = 'en-US';
            window.speechSynthesis.speak(utterance);
          });
          div.appendChild(audioBtn);

          userStoriesDiv.appendChild(div);
        });
      });
    }

    // Handle new story submission
    storyForm.addEventListener('submit', async e => {
      e.preventDefault();
      const authorFirstName = e.target.authorFirstName.value.trim();
      const authorLastName = e.target.authorLastName.value.trim();
      const title = e.target.title.value.trim();
      const content = e.target.content.value.trim();

      if (!authorFirstName || !authorLastName || !title || !content) {
        alert('Please fill out all fields.');
        return;
      }

      // Save author info locally to identify user on reload
      localStorage.setItem('authorFirstName', authorFirstName);
      localStorage.setItem('authorLastName', authorLastName);

      try {
        await addDoc(collection(db, 'stories'), {
          authorFirstName,
          authorLastName,
          title,
          content,
          createdAt: new Date()
        });
        alert('Story added successfully!');
        e.target.reset();
      } catch (error) {
        alert('Error adding story: ' + error.message);
      }

      renderAddedStories();
    });

    // Initial load show main story tab
    btnStory.click();
  </script>
</body>
</html>
